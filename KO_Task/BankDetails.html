<!DOCTYPE html>
<html>
    <head>
        <title>Example KnockOut JS</title>
        <link rel="stylesheet" href="BankDetails.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.5.0/knockout-min.js"></script>

        <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script> -->

        <!-- <script src="/home/z0406@ad.ziffity.com/Documents/Knockout Js/Practice/BankDetails.js"></script> -->
        
    </head>
    <body>

        <div>
        <h2>Bank Account Details</h2>

        Account Details : <select id="selectoption" data-bind="options:Accounts,optionsText:'Name',value:selectedAccount"></select>
        
         </div>
       
        <hr/>
        <div>
        
        <p> Account Number : <strong data-bind="text:selectedAccount().AccountNumber"></strong> </p>

        <p> Account Holder Name : <strong data-bind="text:selectedAccount().Name"></strong> </p>
       
         <p> Account Balance :<strong data-bind="text:selectedAccount().Balance"></strong> </p>
        </div>

        <div>
         <button data-bind="click : showTable">All Details</button>
         <button data-bind="click : showCreateAccountDetails">Create Account</button>
         <button data-bind="click : showDeleteAccountDetails">Delete Account</button>
         <button data-bind="click : showDepositDetails">Deposit</button>
         <button data-bind="click : showWithdrawDetails">Withdraw</button>

        </div>
        
        <div data-bind="visible: showTableData">
            <hr/>
        <table >
            <thead>
                <tr>
                    <th>Account Number</th>
                    <th>Account Holder Name</th>
                    <th>Contact Number</th>
                    <th>Account Balance</th>
                </tr>
            </thead>
            <tbody data-bind="template: { name: 'accountTemplate', foreach: Accounts }"></tbody>
        </table>
        <div><p id="totBalance">Total Balance : <strong data-bind="text: totalBalance"></strong></p></div>
        </div>
        <script type="text/html" id="accountTemplate">
            <tr>
                <td data-bind="text: AccountNumber"></td>
                <td data-bind="text: Name"></td>
                <td data-bind="text: Contact"></td>
                <td data-bind="text: Balance"></td>
            </tr>
        </script>
       
        <div data-bind="visible: showCreateAccount">
            <hr/>
            <h3>New Account Details</h3>
            
            <p style="margin: 0.2rem"> Name : <input type="text" data-bind="value:newAccountName"></p>
            <h6 data-bind="hidden: isNameCorrect" style="color: red;  margin:0rem 5rem">Enter valid name</h6><br>
            <p style="margin: 0.2rem">Contact Number : <input type="text" data-bind="value : newContactNumber" ></p>
            <h6 data-bind="hidden: isContactCorrect" style="color: red; margin:0rem 9rem">Enter valid contact number</h6><br>
            <p style="margin: 0.2rem"> Deposite : <input type="text" data-bind="value:newDepositeBalance"> </p>
            <h6 data-bind="hidden: isDepositCorrect" style="color: red; margin:0rem 6rem">Enter valid deposit Amount</h6><br>

            <button data-bind="click:AddNewAccount">Submit</button>
        </div>

        <!-- <p>New Balance :<input type="text" data-bind="value: selectedAccount().Balance" ></p> -->
        <!-- <p>Update AccountNumber :<input type="text" data-bind="value:selectedAccount().AccountNumber" ></p> -->
        <!-- <p>Update Name :<input type="text" data-bind="value: selectedAccount().Name" ></p> -->

        <div id="overlay" data-bind="visible: showOverlay">
        <div id="overlay-content" data-bind="css: {
            'success': showCreateAccountSuccess() || showDeleteAccountSuccess() || showDepositSuccess() || showWithdrawSuccess(),
            'error': !showCreateAccountSuccess() && !showDeleteAccountSuccess() && !showDepositSuccess() && !showWithdrawSuccess()
        }">
            <p data-bind="text: errorMessage"></p>
                    
            <button type="submit" data-bind="click: hideOverlay">CLOSE</button>

        </div>

         
                    
           
        </div>
        <!-- <button data-bind="click: showOverlay" style="border: none;background-color: white;cursor: pointer;">
            <i class="fa fa-bug"></i>
        </button> -->

        <!-- <div>
            <p data-bind="text: showCreateAccountSuccess"></p>
            <p data-bind="text: showDeleteAccountSuccess"></p>
            <p data-bind="text: showDepositSuccess"></p>
            <p data-bind="text: showWithdrawSuccess"></p>
        </div> -->
                         
        <div data-bind="visible: showDeleteAcoount">
            <hr/>
            <h3> Remove Account</h3>
            <p style="margin: 0.2rem">Name or Account Number : <input type="text" data-bind="value:removeAccount" placeholder="type name or account number"/></p>
            <h6 data-bind="hidden: isAccountFound" style="color: red; margin:0rem 13rem">Account Not Found</h6><br>
            <button data-bind="click:removeAccountDetails">Delete</button>

        </div>
        
        <div data-bind="visible: showDeposit">
         <hr/>
        <h3>Deposit </h3>
            <div><p style="margin: 0.2rem">Deposit  Balance : <input type="text" data-bind="value: depositeAmount"/></p>
            <h6 data-bind="hidden: isDepositeAmountCorrect" style="color: red; margin: 0 9rem">Enter Valid Amount</h6><br>
            <button data-bind="click: deposite">Deposit</button>
            </div>
            <br/>
        </div>

        <div data-bind="visible: showWithdraw">
            <hr/>
            <h3>Withdraw</h3>
            <div><p style="margin: 0.2rem">Withdraw  Balance : <input type="text" data-bind="value: withdrawAmount"/></p>
            <h6 data-bind="hidden: isWithdrawAmountCorrect" style="color: red; margin: 0 9.2rem">Enter valid withdraw Amount</h6><br>
            <button data-bind="click: withdraw">Withdraw</button>
            </div>
        </div>
    <script>
        var Account = function(account,name,contact,balance){
            this.AccountNumber = ko.observable(account);
            this.Name =ko.observable(name);
            this.Contact = ko.observable(contact)
            this.Balance = ko.observable(balance);
          
        } 
        var MyViewModel= function(acc){
            // this.AccountNumber=acc.AccountNumber;
            // this.Name=acc.Name;
            // this.Contact = acc.Contact ;
            // this.Balance = acc.Balance;
            this.Accounts = ko.observableArray(acc);
            this.selectedAccount = ko.observable(this.Accounts()[0]);

            this.showTableData = ko.observable(false);
            this.showCreateAccount = ko.observable(false);
            this.showDeleteAcoount = ko.observable(false) ;
            this.showDeposit = ko.observable(false);
            this.showWithdraw = ko.observable(false) ;
            this.errorMessage = ko.observable('')

            this.showTable = function() {
            this.showTableData(!this.showTableData());
            }
            // this.showTable = function() {
            //     window.location.href = "BankDetailsTable.html";
            // };

            this.showCreateAccountDetails = function() {
                 this.showCreateAccount(!this.showCreateAccount());
                 this.showDeleteAcoount(false);;
                 this.showDeposit(false);
                 this.showWithdraw(false);
            }

            this.showDeleteAccountDetails = function(){
                this.showDeleteAcoount(!this.showDeleteAcoount());
                this.showDeposit(false);
                this.showWithdraw(false);
                this.showCreateAccount(false);
            }

            this.showDepositDetails = function(){
                this.showDeposit(!this.showDeposit());
                this.showDeleteAcoount(false);;
                this.showWithdraw(false);
                this.showCreateAccount(false);
            }

            this.showWithdrawDetails = function(){
                this.showWithdraw(!this.showWithdraw());
                this.showDeleteAcoount(false);;
                this.showDeposit(false);
                this.showCreateAccount(false);
            }


            this.totalBalance = ko.computed(function(){
                var accounts = this.Accounts();
                var total = 0;
                for(var i =0 ; i<accounts.length;i++){
                    total+=accounts[i].Balance();
                }
                return total;
            },this);



            this.showOverlay = ko.observable(false)

            this.showOverlay.subscribe(function(newValue) {
                    if(newValue)
                    {
                        document.getElementById('overlay').style.display = "flex";
                    } else {
                        document.getElementById('overlay').style.display = 'none';
                    }
                }
            )

            this.hideOverlay = function() {
                this.showOverlay(false);
                    // $('.lightHouse .lightDown .lightDownOne').css('background-color', "aqua");
            
            };

            
           
            this.showCreateAccountSuccess = ko.observable(false);
            this.showDeleteAccountSuccess = ko.observable(false);
            this.showDepositSuccess = ko.observable(false);
            this.showWithdrawSuccess = ko.observable(false);


           
            //deposit money

            this.depositeAmount = ko.observable("");
            this.isDepositeAmountCorrect = ko.observable(true);
            

            this.deposite = function(){
                this.showDepositSuccess(false);
                this.isDepositeAmountCorrect(true); 
                var amount = Number(this.depositeAmount());
                if(isNaN(amount) || amount <=0 ){
                    // this.showOverlay(true)
                    // this.errorMessage('Please Enter Correct Amount');
                    this.isDepositeAmountCorrect(false); 
                    // alert("Please Enter Correct Amount");
                }
                if(!isNaN(amount) && amount > 0){
                this.selectedAccount().Balance(this.selectedAccount().Balance() + amount);
                this.depositeAmount("");
                this.showDepositSuccess(true);
                this.showOverlay(true)
                this.errorMessage('deposited Successfully');
                
                }
                
            };
            
            //to withdraw amount


            this.withdrawAmount = ko.observable("");
            this.isWithdrawAmountCorrect = ko.observable(true);

            this.withdraw = function(){
                var wdAmount = Number(this.withdrawAmount()); 
                this.isWithdrawAmountCorrect(true);
                this.showWithdrawSuccess(false)

                if(!isNaN(wdAmount)){
                    if(wdAmount < 500){
                        this.isWithdrawAmountCorrect(false);
                        // this.showOverlay(true)
                        // this.errorMessage('Enter the amount above 500')
                    }
                    else if(this.selectedAccount().Balance() >= wdAmount){
                        this.selectedAccount().Balance(this.selectedAccount().Balance() - wdAmount);
                        this.withdrawAmount("");
                        this.showOverlay(true)
                        this.errorMessage('Withdraw Successfully');
                        this.showWithdrawSuccess(true);
                    }
                    else{
                        this.isWithdrawAmountCorrect(false);
                        // this.showOverlay(true)
                        // this.errorMessage('Your account have Insufficient Balance');
                    }
                }
                else{
                    this.isWithdrawAmountCorrect(false);
                    // this.showOverlay(true)
                    //     this.errorMessage('Please enter a correct amount.');
                }

        
                
                
                
            };

            //to add account details

            this.newAccountName = ko.observable('');
            this.newContactNumber  = ko.observable('');
            this.newDepositeBalance = ko.observable('');

            this.isNameCorrect=ko.observable(true);
            this.isContactCorrect = ko.observable(true);
            this.isDepositCorrect= ko.observable(true);


            // this.showOverlay = ko.observable(false)

            // this.showOverlay.subscribe(
            //     function(newValue)
            //     {
            //         if(newValue)
            //         {
            //             document.getElementById('overlay').style.display = "flex";
            //         } else {
            //             document.getElementById('overlay').style.display = 'none';
            //         }
            //     }
            // )

            // this.hideOverlay = function() {
            //         this.showOverlay(false);
            //         // $('.lightHouse .lightDown .lightDownOne').css('background-color', "aqua");

            //     };


            this.AddNewAccount = function(){
                this.showCreateAccountSuccess(false);

                this.isNameCorrect(false);
                this.isContactCorrect(false);
                this.isDepositCorrect(false)
           
                var name = this.newAccountName();
                var deposit = Number(this.newDepositeBalance());
                var number = (this.newContactNumber());
                if(name != "" && deposit != "" && number != ""){

                    this.isNameCorrect(false)
                    this.isContactCorrect(false)
                    this.isDepositCorrect(false)
                    if(/^[A-Za-z]+$/.test(name.trim())  ){
                        this.isNameCorrect(true)
                    }
                    else{
                        this.isNameCorrect(false)
                    }
                        
                        if(/^[0-9]{10}$/.test(number.trim())){
                            this.isContactCorrect(true)
                        }
                        else
                        {
                            this.isContactCorrect(false)
                        }
                            if(!isNaN(deposit) && deposit >= 0 ){

                                this.isDepositCorrect(true)
                            }
                            else{
                                this.isDepositCorrect(false)
                            }


                            if(this.isNameCorrect() && this.isContactCorrect() && this.isDepositCorrect())
                            {

                                var newAcc = new Account(accViewModel.Accounts().length + 1,name,Number(number),deposit);

                                console.log(newAcc)
                                this.Accounts.push(newAcc);
                                this.newAccountName('');
                                this.newContactNumber('');
                                this.newDepositeBalance('');

                                this.showOverlay(true)
                                this.errorMessage('New Account Created Successfully');
                                this.showCreateAccountSuccess(true);
                            }
                                // this.selectedAccount(newAcc);
                                //  console.log(accViewModel.Accounts().length);
                               // console.log(typeof number)
                                // console.log(accViewModel.Accounts()[accViewModel.Accounts().length - 1].Name());
                                // console.log(accViewModel.Accounts()[accViewModel.Accounts().length - 1].AccountNumber());
                                // console.log(accViewModel.Accounts()[accViewModel.Accounts().length - 1].Balance())
                            }
                            
            
                        else {
                            this.isNameCorrect(false);
                            this.isContactCorrect(false);
                            this.isDepositCorrect(false)
                        }
            

            }
            
            //to delete Account details
            this.removeAccount = ko.observable('');
            this.isAccountFound = ko.observable(true);

            this.removeAccountDetails = function(){
                this.showDeleteAccountSuccess(false);
               
                var remAccount=this.removeAccount();
                var account = accViewModel.Accounts();
                var toRemoveAcc = null;
                
                for(var i=0; i<account.length; i++){
                    if(account[i].Name()=== remAccount || account[i].AccountNumber()=== Number(remAccount)){
                    toRemoveAcc = account[i];
                    break;
                    }
                }

                if(toRemoveAcc){
                    this.Accounts.remove(toRemoveAcc);
                     this.isAccountFound(true);
                    this.showOverlay(true);
                    this.errorMessage(' Account Removed Successfully');
                    this.showDeleteAccountSuccess(true);
                    if(toRemoveAcc ===this.selectedAccount()){
                        this.selectedAccount(this.Accounts()[0]);
                        
                    }
                }
                else{
                    // this.showOverlay(true)
                    // this.errorMessage('Account Not Found');
                    // // alert("Account Not Found");
                    this.isAccountFound(false);
                }
                this.removeAccount("");
            };


             
            
        }
        

       
        var acc =[
                new Account(1,"A",9987787957,12060),
                new Account(2,"AB",6782348769,13000),
                new Account(3,"ABC",9876655545,14000)
            ];
        var accViewModel = new MyViewModel(acc);
        // var accViewModel = new MyViewModel(1,"A1",12000);
        ko.applyBindings(accViewModel); 
      </script>

     
    </body>
</html>